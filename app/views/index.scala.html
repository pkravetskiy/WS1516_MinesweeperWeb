@(message: String, controller:de.htwg.se.controller.IController)
@import java.math.BigInteger;val lines=controller.getPlayingField.getLines;val cols=controller.getPlayingField.getColumns;
@main("Minesweeper") {
  <script language="JavaScript">
  //Create a new socket
  $(function() {
    var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket
    sock = new WS("@routes.Application.sockHandler().webSocketURL(request)")

    sock.onmessage = function(event) {
      //Nothing for the moment
    }

    $('button.send').click(function() {
      sock.send("I'm sending a message now.")
    });
  })
  //Function for Minesweeper buttons
  function sendClick(row,column) {
    if (row < 10 && column < 10) {
      sock.send("0" + row + "-0" + column);
    } else if (row < 10 && column >= 10) {
      sock.send("0" + row + "-" + column);
    } else if (row >= 10 && column < 10) {
      sock.send(row + "-0" + column);
    } else {
      sock.send(row + "-" + column);
    }
  }
  //Function for Navbar
  function sendNav(command) {
    sock.send(command);
  }
  </script>

  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="/"><img alt="Brand" height="20" width="20" src="@routes.Assets.at("images/minesweepericon.png")"></a>
        <a class="navbar-brand" href="/">Minesweeper</a>
      </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">New Game<span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/index" onclick="sendNav('n')">Restart</a></li>
            <li><a href="/index" onclick="sendNav('sS')">Small</a></li>
            <li><a href="/index" onclick="sendNav('sM')">Medium</a></li>
            <li><a href="/index" onclick="sendNav('sL')">Large</a></li>
          </ul>
        </li>
        <li><a href="/index" onclick="sendNav('u')">Undo</a></li>
        <li><a href="/index" onclick="sendNav('r')">Redo</a></li>
        <li><a href="/">About</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
  </nav>

    <!-- End of the game modal dialog -->
  <div class="modal fade bs-example-modal-sm" id="game_end" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <h1 id="result">You lose</h1>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="window.location.reload(); sendNav('sS');">Restart</button>
          </div>
        </div>
    </div>
  </div>

  <div class="row">
    <div style="text-align: center;">
    <h1>&nbsp;&nbsp;Minesweeper</h1>
    <ul id="qwerty" style="list-style-type:none">
        @if(controller.isGameOver()) {<script>result('You lose')</script>}
        @if(controller.isVictory()) {<script>result('You won!')</script>}
    @for(line <- 1 until lines + 1){
      <li><div style="white-space: nowrap">
      @for(col <- 1 until cols + 1){
        <span class="Span">
          <a href="/index" onclick="sendClick(@line, @col)"
          @if(controller.getPlayingField.getCell(line, col).isRevealed) {
              class="key not_active"
          } else {
            class="key"
          }>
            <span class="Span" id="@line-@col">
              @if(!controller.getPlayingField.getCell(line, col).isRevealed) {
                  &nbsp;
              } else {
                @if(controller.getPlayingField.getCell(line, col).getValue() == 0) {
                    &nbsp;
                } else {
                  @if(controller.getPlayingField.getCell(line, col).getValue() == -1) {
                    <img class="Mine" align="middle" height="27" width="27" src="@routes.Assets.at("images/minesweepericon.png")">
                  } else {
                    @controller.getPlayingField.getCell(line, col).getValue()
                  }
                }
              }
            </span>
          </a>
        </span>
      }
      </div></li>
    }
    </ul>
  <nav class="navbar navbar-default navbar-fixed-bottom">
  <div class="container">
    <ul class="nav navbar-nav navbar-right">
      <li><a href="/license" >License</a></li>
      <li><a target="_blank" href="https://github.com/pkravetskiy/WS1516_MinesweeperWeb">Github</a></li>
      <li><a href="/authors">Authors</a></li>
    </ul>
  </div>
</nav>
}
